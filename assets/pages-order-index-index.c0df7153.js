import{s as e,u as t,_ as a}from"./sc-order-product.cf0011e0.js";import{r,d as s,x as l,u as i,w as o,n,a as u,c as d,q as c,b as p,e as f,f as m,h as b,m as g,j as h,i as v,k as x,F as y,l as w,p as _,t as S,A as C,s as k,S as j,C as D,D as L,M as N,Z as I,_ as F,E as R,$ as z,G as $}from"./index.4b002d2b.js";import{g as T}from"./order.e64a24ff.js";import{_ as W}from"./_plugin-vue_export-helper.cdc0426e.js";import{_ as B}from"./sc-empty.0e0c468b.js";import{_ as q}from"./sc-load-more.c7300637.js";import{_ as O}from"./sc-button.3d3eb510.js";import{O as V,a as A}from"./order.c4e6208f.js";import{r as P}from"./route.99ab519a.js";import"./uni-qrcode.a0d42b81.js";import"./sc-icon.52d4ad3f.js";import"./sc-popup.5c6e9a7f.js";import"./index.dfc28261.js";import"./product.d0fc3ac7.js";const M=W(s({__name:"sc-swiper-tabs",props:{...{isScroll:{type:Boolean,default:!0},list:{type:Array,default:()=>[{name:"标签一"},{name:"标签二"},{name:"标签三"},{name:"标签四"}]},current:{type:[Number,String],default:0},height:{type:[Number,String],default:80},fontSize:{type:[Number,String],default:30},swiperWidth:{type:[String,Number],default:750},activeColor:{type:String,default:"#385aff"},inactiveColor:{type:String,default:"#303133"},barWidth:{type:[Number,String],default:40},barHeight:{type:[Number,String],default:6},gutter:{type:[Number,String],default:40},zIndex:{type:[Number,String],default:1},bgColor:{type:String,default:"#ffffff"},autoCenterMode:{type:String,default:"window"},name:{type:String,default:"name"},count:{type:String,default:"count"},offset:{type:Array,default:()=>[5,20]},bold:{type:Boolean,default:!0},activeItemStyle:{type:Object,default:()=>({})},showBar:{type:Boolean,default:!0},barStyle:{type:Object,default:()=>({})},windowWidth:{type:Number,default:375}}},emits:["update:modelValue","change","input"],setup(e,{expose:t,emit:a}){const s=e;t({setDx:function(e){let t=e>0?+L+1:+L-1;t=t<=0?0:t,t=t>=s.list.length?s.list.length-1:t;const a=z.value[+L],r=a.left+a.width/2,l=z.value[t],i=l.left+l.width/2,o=Math.abs(i-r);I.value=e/R.value*o},setFinishCurrent:U});const D=r(0);let L=s.current;const N=r(0),I=r(0),F=r(0),R=r(0),z=r([]);r([]);const $="DST",T=l((()=>s.list)),W=l((()=>{const e=Number(s.current);return e>T.value.length-1?T.value.length-1:e<0?0:e})),B=l((()=>Number(F.value)+Number(I.value))),q=l((()=>i(+s.barWidth))),O=l((()=>e=>{let t={height:`${s.height}rpx`,lineHeight:`${s.height}rpx`,padding:`0 ${Number(s.gutter)/2}rpx`,color:z.value.length>0?z.value[e]?z.value[e].color:s.activeColor:s.inactiveColor,fontSize:`${s.fontSize}rpx`,zIndex:+s.zIndex+2,fontWeight:e===W.value&&s.bold?"bold":"normal"};return e===W.value&&(t=Object.assign(t,s.activeItemStyle)),t})),V=l((()=>{const e={width:`${q.value}px`,height:`${s.barHeight}rpx`,borderRadius:"100px",backgroundColor:s.activeColor,left:`${B.value}px`};return Object.assign(e,s.barStyle)}));async function A(){R.value=i(Number(s.swiperWidth)),await new Promise(((e,t)=>{const a=d().in(c());for(let r=0;r<s.list.length;r++)a.select(`.DST${r}`).boundingClientRect();a.exec((t=>{const a=[];for(let e=0;e<t.length;e++)t[e].color=s.inactiveColor,e===W.value&&(t[e].color=s.activeColor),a.push(t[e]);z.value=a,e(!0)}))})),P(),M((()=>{H()}))}function P(){const e=z.value[+L];e&&(F.value=e.left+e.width/2-q.value/2-z.value[0].left)}function M(e){try{d().in(c()).select(".dfc-swiper-tabs").fields({size:!0},(t=>{t?(N.value=t.width||0,e&&"function"==typeof e&&e(t)):M(e)})).exec()}catch(t){N.value=s.windowWidth}}function H(){const e=z.value[+L];if(e){const t=e.left+e.width/2;let a;a="window"===s.autoCenterMode?s.windowWidth:N.value,D.value=t-a/2}}function U(e){z.value.map(((t,a)=>(t.color=e===a?s.activeColor:s.inactiveColor,t))),I.value=0,L=e,P()}return o((()=>s.current),(e=>{H(),U(+e)})),o((()=>s.list),(()=>{n((()=>{A()}))})),u((()=>A())),(e,t)=>{const r=k,s=j;return p(),f(r,{class:"sc-swiper-tabs w-full transition-property-all",style:h({zIndex:+e.zIndex,background:e.bgColor})},{default:m((()=>[b(s,{"scroll-x":"",class:"sc-scroll-view box-border relative w-full whitespace-nowrap","scroll-left":g(D),"scroll-with-animation":"",style:h({zIndex:+e.zIndex+1})},{default:m((()=>[b(r,{class:v(["sc-scroll-box box-border relative",{"sc-swiper-tabs-scroll-flex":!e.isScroll}])},{default:m((()=>[(p(!0),x(y,null,w(g(T),((t,s)=>(p(),f(r,{key:s,class:v(["sc-swiper-tabs-item box-border relative inline-block text-center transition-property-all",[$+s]]),style:h(g(O)(s)),onClick:e=>function(e){a("change",e)}(s)},{default:m((()=>[_(S(t[e.name]||t.name),1)])),_:2},1032,["style","class","onClick"])))),128)),e.showBar?(p(),f(r,{key:0,class:"sc-scroll-bar box-border absolute bottom-4rpx",style:h({...g(V)})},null,8,["style"])):C("v-if",!0)])),_:1},8,["class"])])),_:1},8,["scroll-left","style"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-bdbb3800"]]),H=W(s({__name:"sc-order",props:{...{itemData:{type:Object,default:()=>V[0]}}},emits:["detail","pay","viewCoupon"],setup(t,{emit:a}){const r=t,s=l((()=>{const{status:e}=r.itemData;return{[A["待支付"]]:"text-error",[A["待使用"]]:"text-primary"}[e]||"text-gray-light"}));return(t,r)=>{const l=k,i=N,o=D(L("sc-button"),O);return p(),f(l,{class:"sc-order box-border mb-20rpx px-32rpx pb-32rpx pt-24rpx text-28rpx bg-white",onClick:r[5]||(r[5]=e=>a("detail",t.itemData.id))},{default:m((()=>[b(l,{class:"py-24rpx flex justify-between border-b-1rpx border-gray-200"},{default:m((()=>[b(l,{class:"text-black-dark"},{default:m((()=>[_(" 订单编号："+S(t.itemData.orderNumber),1)])),_:1}),b(l,{class:v(g(s))},{default:m((()=>[_(S(g(A)[t.itemData.status]),1)])),_:1},8,["class"])])),_:1}),b(l,{class:"mb-28rpx mt-40rpx",onClick:r[1]||(r[1]=e=>a("detail",t.itemData.id))},{default:m((()=>[b(e,{"item-data":t.itemData,onDetail:r[0]||(r[0]=e=>a("detail",t.itemData.product.id))},null,8,["item-data"])])),_:1}),b(l,{class:"flex justify-end items-center"},{default:m((()=>[_(" 实付金额："),b(l,{class:"text-error font-600"},{default:m((()=>[_(" ¥"),b(i,{class:"text-40rpx ml-6rpx"},{default:m((()=>[_(S(t.itemData.price),1)])),_:1})])),_:1})])),_:1}),b(l,{class:"mt-16rpx border-t-1rpx border-gray-200 pt-20rpx flex justify-end"},{default:m((()=>[t.itemData.status===g(A)["待使用"]?(p(),f(l,{key:0,class:"ml-40rpx"},{default:m((()=>[b(o,{width:"160rpx",height:"64rpx",radius:"64rpx",plain:"",background:"#ddd",onClick:r[2]||(r[2]=e=>a("viewCoupon",t.itemData))},{default:m((()=>[b(i,{class:"text-black text-28rpx"},{default:m((()=>[_(" 查看券码 ")])),_:1})])),_:1})])),_:1})):C("v-if",!0),b(l,{class:"ml-40rpx"},{default:m((()=>[b(o,{width:"160rpx",height:"64rpx",radius:"64rpx",plain:"",background:"#ddd",onClick:r[3]||(r[3]=e=>a("detail",t.itemData.id))},{default:m((()=>[b(i,{class:"text-black text-28rpx"},{default:m((()=>[_(" 查看订单 ")])),_:1})])),_:1})])),_:1}),t.itemData.status===g(A)["待支付"]?(p(),f(l,{key:1,class:"ml-40rpx"},{default:m((()=>[b(o,{width:"160rpx",height:"64rpx",radius:"64rpx",background:"#eb483f",onClick:r[4]||(r[4]=e=>a("pay",t.itemData))},{default:m((()=>[b(i,{class:"text-white text-28rpx"},{default:m((()=>[_(" 去支付 ")])),_:1})])),_:1})])),_:1})):C("v-if",!0)])),_:1})])),_:1})}}}),[["__scopeId","data-v-7e851679"]]),U=W(s({__name:"index",setup(e){const{openPopup:s,showPopup:l,canvasId:i,qrCodeImageUrl:o}=t();let n="height:calc(100vh - 80rpx - env(safe-area-inset-bottom, 0));background: #F8F8F8;";n="height:calc(100vh - 80rpx - 44px - 100rpx - env(safe-area-inset-bottom, 0) - env(safe-area-inset-top, 0));background: #F8F8F8;";const u=r([{name:"全部",triggered:!1,_freshing:!1,loadingStatus:"load-more",value:A["全部"],itemsList:[]},{name:"待支付",triggered:!1,_freshing:!1,loadingStatus:"load-more",value:A["待支付"],itemsList:[]},{name:"待使用",triggered:!1,_freshing:!1,loadingStatus:"load-more",value:A["待使用"],itemsList:[]},{name:"已完成",triggered:!1,_freshing:!1,loadingStatus:"load-more",value:A["已完成"],itemsList:[]},{name:"已取消",triggered:!1,_freshing:!1,loadingStatus:"load-more",value:A["已取消"],itemsList:[]}]),{current:d,swiperCurrent:c,uTabs:v,tabsChange:_,transition:S,animationFinish:N,onReachBottom:W,onRefresh:O,onRestore:V,loadData:U}=function(e){const t=r(0),a=r(0),s=r(null);function l(t){if("no-more"!==e.tabsList.value[t].loadingStatus)return e.tabsList.value[t].loadingStatus="loading",new Promise(((a,r)=>{try{setTimeout((()=>{e.tabsList.value[t].triggered=!1,e.tabsList.value[t]._freshing=!1,e.tabsList.value[t].loadingStatus="no-more",e.tabsList.value[t].itemsList=e.loadFn(e.tabsList.value[t].value),a(!0)}),900)}catch(s){r(!1)}}))}return{current:t,swiperCurrent:a,uTabs:s,tabsChange:function(e){a.value=e},transition:function(e){const t=e.detail.dx;s.value.setDx(t)},animationFinish:async function(e){const r=e.detail.current,i=r!==t.value;s.value.setFinishCurrent(r),a.value=r,t.value=r,i&&await l(Number(r))},onReachBottom:function(){},onRefresh:async function(){e.tabsList.value[t.value]._freshing||(e.tabsList.value[t.value]._freshing=!0,e.tabsList.value[t.value].triggered=!0,e.tabsList.value[t.value].itemsList=[],e.tabsList.value[t.value].loadingStatus="load-more",await l(t.value))},onRestore:function(){e.tabsList.value[t.value].triggered="restore"},loadData:l}}({loadFn:T,tabsList:u});function E(e){P(`/pages/order/detail/index?id=${e}`)}function G(e){P(`/pages/order/success/index?id=${e}`)}return I((async()=>{await U(d.value)})),(e,t)=>{const r=D(L("sc-swiper-tabs"),M),I=D(L("sc-empty"),B),T=D(L("sc-load-more"),q),A=k,P=j,U=$,Z=R,J=D(L("sc-popup-qr-code"),a),K=z;return p(),f(A,{class:"order-index"},{default:m((()=>[b(r,{ref_key:"uTabs",ref:v,border:!0,list:g(u),current:g(d),"inactive-color":"#333","is-scroll":!1,"swiper-width":"750",onChange:g(_)},null,8,["list","current","onChange"]),b(Z,{current:g(c),style:h(g(n)),onTransition:g(S),onAnimationfinish:g(N)},{default:m((()=>[(p(!0),x(y,null,w(g(u),((e,t)=>(p(),f(U,{key:t,class:"swiper-item"},{default:m((()=>[b(P,{"scroll-y":"","enable-passive":"","scroll-with-animation":"",style:h(g(n)),"refresher-enabled":!0,"refresher-triggered":e.triggered,"refresher-threshold":100,onScrolltolower:g(W),onRefresherrefresh:g(O),onRefresherrestore:g(V)},{default:m((()=>[(p(!0),x(y,null,w(e.itemsList,(e=>(p(),f(H,{key:e.id,"item-data":e,onViewCoupon:g(s),onDetail:E,onPay:G},null,8,["item-data","onViewCoupon"])))),128)),"no-more"===e.loadingStatus&&0===e.itemsList.length?(p(),f(I,{key:0,mode:"no-data","margin-top":"200",text:"空空如也~"})):(p(),f(T,{key:1,status:e.loadingStatus},null,8,["status"])),b(A,{class:"pb-safe-40"})])),_:2},1032,["style","refresher-triggered","onScrolltolower","onRefresherrefresh","onRefresherrestore"])])),_:2},1024)))),128))])),_:1},8,["current","style","onTransition","onAnimationfinish"]),b(J,{modelValue:g(l),"onUpdate:modelValue":t[0]||(t[0]=e=>F(l)?l.value=e:null),"qr-code-image":g(o)},null,8,["modelValue","qr-code-image"]),C(" 弹框方式无法生成二维码，画布元素需在外部定义 "),b(K,{id:g(i),style:{width:"520px",height:"520px",position:"fixed",top:"200vh",left:"200vw"},"canvas-id":g(i)},null,8,["id","canvas-id"])])),_:1})}}}),[["__scopeId","data-v-560a7508"]]);export{U as default};
